<!DOCTYPE html>
<html lang="en">

<footer class="footer" onload="checkSubscription()">
  <div>
    <p class="footer-top">Built using:</p>
    <a href="https://romanzolotarev.com/ssg.html" class="footer-ssg"><b>SSG</b> by Roman Zolotarev</a>
  </div>
  <div>
     <form onsubmit="subscribe()" class="subscription-box" id="sub-form">
       <input type="text" id="name" placeholder="name...">
       <input type="email" id="email" placeholder="email address...">
       <input id="subscribe-button"  type="submit" value="Subscribe">
     </form> 
  <div>
</footer>
<script type="text/javascript">
   (function checkSubscription() {
      console.log('checking subscription');
      const subscribed = localStorage.getItem('subscribed');
      if (subscribed) {
         const form = document.getElementById("sub-form");
         form.style.display = "none";
      }; 
   })();
 
   function subscribe() {
      event.preventDefault();
      const name = document.querySelector('#name').value;
      const email = document.querySelector('#email').value;
      const subscriber = { name: name, email: email };
      const url = 'https://e94nqk77ka.execute-api.ap-southeast-2.amazonaws.com/api';
      const options = {
        method: 'POST',
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(subscriber),
      };
      fetch(url, options)
      .then(res => res.json())
      .then(({ subscribed }) => {
         localStorage.setItem('subscribed', true);
         localStorage.setItem('name', name);
         const form = document.getElementById("sub-form");
         form.style.display = "none";
      })
      .catch(err => { console.log(err); });
    };
</script>

</html>
